#  README.md — Validate CSV Big

##  Описание  
`validate_csv_big.py` — это Python-скрипт для **валидации больших CSV-файлов**.  
Он позволяет построчно проверять корректность данных и заголовков CSV, логировать ошибки и сохранять очищенные данные.  
Скрипт рассчитан на обработку очень больших файлов с минимальным расходом памяти.

---

##  Требования  
- Python 3.8+  
- Библиотеки Python (стандартные: `argparse`, `csv`, `gzip`, `sys`, `typing`).  
Дополнительные пакеты не требуются.

---

##  Установка  
Скачайте файл `validate_csv_big.py` и убедитесь, что Python установлен.

---

##  Использование  

Запуск через командную строку:  

```bash
python validate_csv_big.py --big path/to/your_big.csv [опции]
```

### Основные параметры CLI  

| Параметр              | Описание                                                                                      | По умолчанию |
|-----------------------|----------------------------------------------------------------------------------------------|-------------|
| `--big` (обязательный)| Путь к **большому CSV** (проверяемый файл).                                                   | —           |
| `--sample`            | CSV-образец для заголовка (если не задан — ожидается стандартный).                            | —           |
| `--out-clean`         | Сохранить очищенный CSV (только валидные строки).                                             | —           |
| `--errors-out`        | Сохранить полный лог ошибок (CSV или .gz).                                                    | —           |
| `--sample-per-type`   | Сколько примеров на каждый тип ошибки показать в консоли.                                     | `5`         |
| `--max-print-errors`  | Сколько ошибок максимально печатать в stdout.                                                 | `50`        |
| `--progress-every`    | Каждые N строк печатать прогресс (0 чтобы отключить).                                          | `100000`    |

Пример запуска:  

```bash
python validate_csv_big.py   --big data/huge_file.csv   --sample data/schema.csv   --out-clean data/clean.csv   --errors-out data/errors.csv.gz   --sample-per-type 10   --max-print-errors 100   --progress-every 50000
```

Еще пример:
```bash
python validate_csv_big.py \       
  --big ~/Documents/v1/data/keys_fl_clean.csv \
  --sample ~/Downloads/keys.csv \
  --errors-out ~/Downloads/your_big_file.errors.csv.gz \
  --out-clean  ~/Downloads/your_big_file.clean.csv \
  --sample-per-type 10 \
  --max-print-errors 200 \
  --progress-every 200000
```
---

##  Основные функции  

| Функция                   | Назначение                                                                                 |
|---------------------------|-------------------------------------------------------------------------------------------|
| `open_text_utf8_strict()` | Безопасное открытие файла в UTF-8 с обработкой ошибок.                                     |
| `check_utf8_streaming()`  | Проверка потока на корректность UTF-8.                                                     |
| `read_header()`           | Чтение и валидация заголовка CSV.                                                          |
| `validate_row()`          | Валидация отдельной строки CSV.                                                            |
| `open_errors_writer()`    | Создание writer’а для записи ошибок.                                                       |
| `validate_csv()`          | Основная функция для построчной проверки большого CSV.                                     |
| `main()`                  | Точка входа CLI: парсит аргументы, запускает проверку.                                     |

---

##  Вывод результатов  
- В консоль выводится краткая сводка ошибок (с примерами).  
- В файл `--errors-out` сохраняется полный лог ошибок.  
- При указании `--out-clean` сохраняется очищенный CSV (только валидные строки).  
- Отображается прогресс каждые N строк (параметр `--progress-every`).  

---

##  Примеры сценариев  
- **Сравнение с эталонным CSV**: проверка структуры и заголовков.  
- **Фильтрация**: сохранение только валидных строк в новый файл.  
- **Аудит данных**: получение детального лога всех ошибок.  

---

##  Лицензия  
Нету - бери и пользуй.  
